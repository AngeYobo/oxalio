server:
  port: 8080

spring:
  application:
    name: api-gateway
  profiles:
    active: demo

  security:
    user:
      name: admin
      password: admin

  cloud:
    gateway:
      default-filters:
        - AddResponseHeader=X-Oxalio-Gateway,true
        - DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials

      globalcors:
        add-to-simple-url-handler-mapping: true
        corsConfigurations:
          '[/**]':
            allowedOrigins:
              - "https://3000-sidereal-election-ozhudl.us1.demeter.run"
              - "http://localhost:3000"
              - "https://8080-sidereal-election-ozhudl.us1.demeter.run"
            allowedMethods: [ GET, POST, PUT, PATCH, DELETE, OPTIONS ]
            allowedHeaders: "*"
            exposedHeaders: [ Authorization, Cache-Control, Content-Type, X-Oxalio-Gateway ]
            allowCredentials: true

      routes:
        - id: auth-service
          uri: http://localhost:8081
          predicates:
            - Path=/api/v1/auth/**
          filters:
            - StripPrefix=2

        - id: invoice-service
          uri: http://localhost:8082
          predicates:
            - Path=/api/v1/invoices/**
          filters:
            - StripPrefix=0

        - id: integration-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/v1/integration/**
          filters:
            - StripPrefix=2

management:
  endpoints:
    web:
      exposure:
        include: health, info, metrics, loggers, gateway
  endpoint:
    gateway:
      enabled: true        # âœ… Activation explicite
    health:
      show-details: always
  metrics:
    tags:
      application: ${spring.application.name}

logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: INFO
    com.oxalio.gateway: DEBUG
