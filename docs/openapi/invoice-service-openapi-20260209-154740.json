{"openapi":"3.0.1","info":{"title":"Oxalio Invoice Service API","description":"Invoice lifecycle, FNE/DGI integration, PDF generation (audit-ready).","contact":{"name":"Oxalio Labs","email":"support@oxalio.io"},"license":{"name":"Proprietary"},"version":"1.0.0"},"servers":[{"url":"http://localhost:8082","description":"Generated server url"}],"tags":[{"name":"SellerProfiles","description":"Gestion du profil vendeur (logo, etc.)"},{"name":"Auth","description":"Authentication (mock only, dev/test)"},{"name":"Invoices","description":"API de gestion des factures FNE"},{"name":"Tenants","description":"Gestion des tenants (clients OXALIO - enregistrement, status, subscription)"},{"name":"FNE","description":"DGI / FNE operations (signing, refund, RNE ticket, config)"}],"paths":{"/api/v1/tenants/{id}":{"get":{"tags":["Tenants"],"summary":"Obtenir un tenant par ID","operationId":"getTenantById","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TenantDTO"}}}}}},"put":{"tags":["Tenants"],"summary":"Mettre à jour un tenant","operationId":"updateTenant","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateTenantRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TenantDTO"}}}}}},"delete":{"tags":["Tenants"],"summary":"Supprimer un tenant (Admin uniquement)","operationId":"deleteTenant","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"200":{"description":"OK"}}}},"/api/v1/tenants/{id}/subscription/upgrade":{"put":{"tags":["Tenants"],"summary":"Upgrader le plan d'abonnement","operationId":"upgradePlan","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}},{"name":"newPlan","in":"query","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TenantDTO"}}}}}}},"/api/v1/tenants/{id}/status":{"put":{"tags":["Tenants"],"summary":"Activer/Désactiver un tenant (Admin uniquement)","operationId":"toggleTenantStatus","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}},{"name":"active","in":"query","required":true,"schema":{"type":"boolean"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TenantDTO"}}}}}}},"/api/v1/invoices/{id}":{"get":{"tags":["Invoices"],"summary":"Obtenir une facture par ID","operationId":"getInvoiceById","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/InvoiceResponse"}}}}}},"put":{"tags":["Invoices"],"summary":"Mettre à jour une facture","operationId":"updateInvoice","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/InvoiceRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/InvoiceResponse"}}}}}},"delete":{"tags":["Invoices"],"summary":"Supprimer une facture","operationId":"deleteInvoice","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"200":{"description":"OK"}}}},"/api/v1/tenants/register":{"post":{"tags":["Tenants"],"summary":"Inscription d'un nouveau tenant","operationId":"registerTenant","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateTenantRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TenantDTO"}}}}}}},"/api/v1/sellers/{taxId}/logo":{"get":{"tags":["SellerProfiles"],"summary":"Récupérer le logo du vendeur (binaire)","operationId":"getLogo","parameters":[{"name":"taxId","in":"path","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"type":"array","items":{"type":"string","format":"byte"}}}}}}},"post":{"tags":["SellerProfiles"],"summary":"Uploader le logo du vendeur","operationId":"uploadLogo","parameters":[{"name":"taxId","in":"path","required":true,"schema":{"type":"string"}}],"requestBody":{"content":{"application/json":{"schema":{"required":["file"],"type":"object","properties":{"file":{"type":"string","format":"binary"}}}}}},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/SellerProfileEntity"}}}}}},"delete":{"tags":["SellerProfiles"],"summary":"Supprimer le logo du vendeur","operationId":"deleteLogo","parameters":[{"name":"taxId","in":"path","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"OK"}}}},"/api/v1/invoices":{"get":{"tags":["Invoices"],"summary":"Lister toutes les factures","operationId":"getAllInvoices","responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/InvoiceResponse"}}}}}}},"post":{"tags":["Invoices"],"summary":"Créer une facture","description":"Crée une facture FNE complète avec numéro, totals auto, QR et sticker","operationId":"createInvoice","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/InvoiceRequest"}}},"required":true},"responses":{"201":{"description":"Facture créée","content":{"*/*":{"schema":{"$ref":"#/components/schemas/InvoiceResponse"}}}},"400":{"description":"Données invalides","content":{"*/*":{"schema":{"$ref":"#/components/schemas/InvoiceResponse"}}}},"500":{"description":"Erreur interne","content":{"*/*":{"schema":{"$ref":"#/components/schemas/InvoiceResponse"}}}}}}},"/api/v1/invoices/{id}/submit-to-dgi":{"post":{"tags":["Invoices"],"summary":"Soumettre une facture à la DGI (mock)","operationId":"submitToDgi","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/InvoiceResponse"}}}}}}},"/api/v1/invoices/{id}/refund":{"post":{"tags":["Invoices"],"summary":"Générer un avoir (Refund) pour une facture","operationId":"refundInvoice","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefundRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/InvoiceResponse"}}}}}}},"/api/fne/invoices/{invoiceIdOrReference}/refund":{"post":{"tags":["FNE"],"operationId":"createRefund","parameters":[{"name":"invoiceIdOrReference","in":"path","required":true,"schema":{"type":"string"}}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefundRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/FneRefundResponse"}}}}}}},"/api/fne/invoices/sign":{"post":{"tags":["FNE"],"operationId":"signInvoice","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/InvoiceSignRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/FneInvoiceResponse"}}}}}}},"/api/auth/register":{"post":{"tags":["Auth"],"operationId":"register","requestBody":{"content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"object"}}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"type":"object"}}}}}}},"/api/auth/login":{"post":{"tags":["Auth"],"operationId":"login","requestBody":{"content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"object"}}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"type":"object"}}}}}}},"/api/v1/tenants":{"get":{"tags":["Tenants"],"summary":"Lister tous les tenants (Admin OXALIO uniquement)","operationId":"getAllTenants","parameters":[{"name":"activeOnly","in":"query","required":false,"schema":{"type":"boolean"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/TenantDTO"}}}}}}}},"/api/v1/tenants/stats":{"get":{"tags":["Tenants"],"summary":"Statistiques des tenants","operationId":"getTenantStats","responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TenantStatsDTO"}}}}}}},"/api/v1/tenants/slug/{slug}":{"get":{"tags":["Tenants"],"summary":"Obtenir un tenant par slug","operationId":"getTenantBySlug","parameters":[{"name":"slug","in":"path","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TenantDTO"}}}}}}},"/api/v1/tenants/ncc/{ncc}":{"get":{"tags":["Tenants"],"summary":"Obtenir un tenant par NCC","operationId":"getTenantByNcc","parameters":[{"name":"ncc","in":"path","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TenantDTO"}}}}}}},"/api/v1/invoices/{id}/pdf":{"get":{"tags":["Invoices"],"operationId":"downloadPdf","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"type":"array","items":{"type":"string","format":"byte"}}}}}}}},"/api/v1/invoices/number/{invoiceNumber}":{"get":{"tags":["Invoices"],"summary":"Obtenir une facture par numéro","operationId":"getInvoiceByNumber","parameters":[{"name":"invoiceNumber","in":"path","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/InvoiceResponse"}}}}}}},"/api/fne/invoices/{internalId}/rne-ticket.pdf":{"get":{"tags":["FNE"],"operationId":"downloadRneTicket","parameters":[{"name":"internalId","in":"path","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"200":{"description":"OK","content":{"application/pdf":{"schema":{"type":"array","items":{"type":"string","format":"byte"}}}}}}}},"/api/fne/config":{"get":{"tags":["FNE"],"operationId":"getConfig","responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"type":"object"}}}}}}}},"components":{"schemas":{"UpdateTenantRequest":{"type":"object","properties":{"companyName":{"maxLength":255,"minLength":2,"type":"string"},"ownerEmail":{"type":"string"},"ownerName":{"type":"string"},"ownerPhone":{"pattern":"^0[0-9]{9}$","type":"string"},"fneApiKey":{"type":"string"},"fneEstablishment":{"type":"string"},"fnePointOfSale":{"type":"string"},"logoUrl":{"type":"string"},"isActive":{"type":"boolean"}}},"TenantDTO":{"type":"object","properties":{"id":{"type":"integer","format":"int64"},"companyName":{"type":"string"},"ncc":{"type":"string"},"slug":{"type":"string"},"fneEstablishment":{"type":"string"},"fnePointOfSale":{"type":"string"},"subscriptionPlan":{"type":"string"},"subscriptionStatus":{"type":"string"},"subscriptionStartedAt":{"type":"string","format":"date-time"},"subscriptionEndsAt":{"type":"string","format":"date-time"},"monthlyInvoiceLimit":{"type":"integer","format":"int32"},"monthlyInvoiceCount":{"type":"integer","format":"int32"},"ownerEmail":{"type":"string"},"ownerName":{"type":"string"},"ownerPhone":{"type":"string"},"logoUrl":{"type":"string"},"isActive":{"type":"boolean"},"isVerified":{"type":"boolean"},"createdAt":{"type":"string","format":"date-time"},"lastLoginAt":{"type":"string","format":"date-time"}}},"BuyerDTO":{"type":"object","properties":{"name":{"type":"string"},"taxId":{"type":"string"},"address":{"type":"string"},"phone":{"type":"string"},"email":{"type":"string"},"regime":{"type":"string"}}},"InvoiceLineDTO":{"type":"object","properties":{"description":{"type":"string"},"quantity":{"type":"number"},"unitPrice":{"type":"number"},"vatRate":{"type":"number"},"vatAmount":{"type":"number"},"discount":{"type":"number"},"lineTotal":{"type":"number"},"sku":{"type":"string"},"unit":{"type":"string"},"productCode":{"type":"string"},"fneItemId":{"type":"string"}}},"InvoiceRequest":{"required":["buyer","currency","invoiceType","lines","paymentMode","seller","template","totals"],"type":"object","properties":{"invoiceNumber":{"type":"string"},"invoiceType":{"pattern":"STANDARD|PROFORMA|CREDIT_NOTE|purchase","type":"string"},"currency":{"pattern":"XOF|USD|EUR","type":"string"},"seller":{"$ref":"#/components/schemas/SellerDTO"},"buyer":{"$ref":"#/components/schemas/BuyerDTO"},"lines":{"type":"array","items":{"$ref":"#/components/schemas/InvoiceLineDTO"}},"totals":{"$ref":"#/components/schemas/TotalsDTO"},"paymentMode":{"pattern":"CASH|TRANSFER|CARD|MOBILE_MONEY|CHECK|DEFERRED","type":"string"},"notes":{"maxLength":500,"minLength":0,"type":"string"},"template":{"pattern":"B2B|B2C|purchase","type":"string"},"isRne":{"type":"boolean"},"rne":{"type":"string"}}},"SellerDTO":{"type":"object","properties":{"companyName":{"type":"string"},"taxId":{"type":"string"},"address":{"type":"string"},"phone":{"type":"string"},"email":{"type":"string"},"regime":{"type":"string"},"taxCenter":{"type":"string"},"rccm":{"type":"string"},"bankRef":{"type":"string"},"establishment":{"type":"string"},"sellerDisplayName":{"type":"string"},"pointOfSaleName":{"type":"string"}}},"TotalsDTO":{"type":"object","properties":{"subtotal":{"type":"number"},"totalVat":{"type":"number"},"totalAmount":{"type":"number"},"totalDiscount":{"type":"number"},"otherTaxes":{"type":"number"},"totalToPay":{"type":"number"}}},"InvoiceResponse":{"type":"object","properties":{"id":{"type":"integer","format":"int64"},"invoiceNumber":{"type":"string"},"invoiceType":{"type":"string"},"template":{"type":"string"},"isRne":{"type":"boolean"},"rne":{"type":"string"},"issueDate":{"type":"string","format":"date-time"},"currency":{"type":"string"},"seller":{"$ref":"#/components/schemas/SellerDTO"},"buyer":{"$ref":"#/components/schemas/BuyerDTO"},"lines":{"type":"array","items":{"$ref":"#/components/schemas/InvoiceLineDTO"}},"totals":{"$ref":"#/components/schemas/TotalsDTO"},"status":{"type":"string"},"paymentMode":{"type":"string"},"stickerId":{"type":"string"},"qrBase64":{"type":"string"},"dgiReference":{"type":"string"},"dgiSubmittedAt":{"type":"string","format":"date-time"},"notes":{"type":"string"},"message":{"type":"string"},"fneInvoiceId":{"type":"string"},"fneReference":{"type":"string"},"fneToken":{"type":"string"},"paymentMethod":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"issuedAt":{"type":"string","format":"date-time"}}},"CreateTenantRequest":{"required":["companyName","ncc","ownerEmail","ownerName","password"],"type":"object","properties":{"companyName":{"maxLength":255,"minLength":2,"type":"string"},"ncc":{"pattern":"^[0-9]{7}[A-Z]$","type":"string"},"ownerEmail":{"type":"string"},"ownerName":{"type":"string"},"ownerPhone":{"pattern":"^0[0-9]{9}$","type":"string"},"password":{"maxLength":2147483647,"minLength":8,"type":"string"},"fneApiKey":{"type":"string"},"fneEstablishment":{"type":"string"},"fnePointOfSale":{"type":"string"},"subscriptionPlan":{"type":"string"}}},"SellerProfileEntity":{"type":"object","properties":{"id":{"type":"integer","format":"int64"},"taxId":{"type":"string"},"companyName":{"type":"string"},"logoPath":{"type":"string"},"logoMimeType":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"}}},"RefundLineRequest":{"type":"object","properties":{"fneItemId":{"type":"string"},"quantity":{"type":"number"},"amount":{"type":"number"}}},"RefundRequest":{"type":"object","properties":{"originalInvoiceId":{"type":"integer","format":"int64"},"reason":{"type":"string"},"lines":{"type":"array","items":{"$ref":"#/components/schemas/RefundLineRequest"}}}},"FneRefundResponse":{"type":"object","properties":{"ncc":{"type":"string"},"reference":{"type":"string"},"token":{"type":"string"},"balanceFunds":{"type":"integer","format":"int32"}}},"InvoiceItemDto":{"required":["amount","description","quantity"],"type":"object","properties":{"reference":{"type":"string"},"taxes":{"type":"array","items":{"type":"string"}},"description":{"type":"string"},"quantity":{"type":"integer","format":"int32"},"amount":{"type":"number"},"discount":{"type":"integer","format":"int32"},"measurementUnit":{"type":"string"}}},"InvoiceSignRequest":{"required":["clientCompanyName","clientEmail","clientPhone","invoiceType","isRne","items","paymentMethod","template"],"type":"object","properties":{"invoiceType":{"type":"string"},"paymentMethod":{"type":"string"},"template":{"pattern":"B2B|B2C|B2F|B2G","type":"string"},"isRne":{"type":"boolean"},"rne":{"type":"string"},"clientNcc":{"type":"string"},"clientCompanyName":{"type":"string"},"clientPhone":{"type":"string"},"clientEmail":{"type":"string"},"establishment":{"type":"string"},"pointOfSale":{"type":"string"},"foreignCurrency":{"type":"string"},"foreignCurrencyRate":{"type":"number"},"commercialMessage":{"type":"string"},"items":{"type":"array","items":{"$ref":"#/components/schemas/InvoiceItemDto"}},"internalInvoiceId":{"type":"integer","format":"int64"}}},"FneInvoiceResponse":{"type":"object","properties":{"ncc":{"type":"string"},"reference":{"type":"string"},"token":{"type":"string"},"warning":{"type":"boolean"},"balanceFunds":{"type":"integer","format":"int32"},"invoice":{"$ref":"#/components/schemas/InvoiceDetails"}}},"InvoiceDetails":{"type":"object","properties":{"id":{"type":"string"},"reference":{"type":"string"},"type":{"type":"string"},"status":{"type":"string"},"date":{"type":"string","format":"date-time"},"amount":{"type":"number"},"totalTaxes":{"type":"number"},"items":{"type":"array","items":{"$ref":"#/components/schemas/InvoiceItemDetails"}}}},"InvoiceItemDetails":{"type":"object","properties":{"id":{"type":"string"},"description":{"type":"string"},"quantity":{"type":"integer","format":"int32"},"amount":{"type":"number"}}},"TenantStatsDTO":{"type":"object","properties":{"totalTenants":{"type":"integer","format":"int64"},"activeTenants":{"type":"integer","format":"int64"},"trialTenants":{"type":"integer","format":"int64"},"starterPlanCount":{"type":"integer","format":"int64"},"professionalPlanCount":{"type":"integer","format":"int64"},"enterprisePlanCount":{"type":"integer","format":"int64"},"totalInvoicesThisMonth":{"type":"integer","format":"int64"},"totalRevenue":{"type":"integer","format":"int64"}}}}}}